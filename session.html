<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>World Clock â€” Fixed</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family: "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial, sans-serif;
      background:#0f172a;
      color:#e6eef8;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:28px;
    }

    .container{width:100%;max-width:720px}
    h1{font-weight:600;color:#cbd5e1;text-align:center;margin-bottom:18px}

    .clock{background:#0b1220;border-radius:12px;padding:14px;box-shadow:0 10px 30px rgba(2,6,23,0.6)}
    .time-line{position:relative;display:flex;flex-direction:column;padding:14px 18px 14px 64px;border-bottom:1px solid rgba(148,163,184,0.06);cursor:pointer;transition:background .15s,transform .12s}
    .time-line:last-child{border-bottom:none}
    .time-line:hover{background:rgba(255,255,255,0.02);transform:translateY(-1px)}
    .time-line:focus{outline:3px solid rgba(96,165,250,0.12)}

    .time-line::before{content:attr(data-icon);position:absolute;left:18px;top:50%;transform:translateY(-50%);font-size:1.2rem}
    .time-header{display:flex;align-items:center;justify-content:space-between}
    .time{font-size:1.35rem;font-weight:700;color:#60a5fa}
    .date{margin-top:6px;color:#94a3b8;font-size:0.98rem}
    .timezone{font-size:0.83rem;color:#94a3b8;margin-top:6px}

    .market-status{display:inline-block;margin-top:8px;padding:6px 10px;border-radius:6px;font-size:0.82rem}
    .market-status.open{background:rgba(34,197,94,0.12);color:#34d399}
    .market-status.closed{background:rgba(239,68,68,0.08);color:#fca5a5}

    .meta-row{display:flex;gap:12px;align-items:center}

    .info-box{margin-top:16px;padding:14px;border-radius:10px;background:#071025;color:#cbd5e1}
    .info-box h2{font-size:1rem;margin-bottom:8px;color:#94a3b8}

    /* small screens */
    @media (max-width:520px){
      .time{font-size:1.1rem}
      .time-line{padding-left:56px}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>World Clock</h1>

    <div class="clock" role="list">
      <!-- Use data attributes; JS will populate times and statuses -->
      <div class="time-line" role="listitem" tabindex="0" id="tz-dhaka" data-tz="Asia/Dhaka" data-icon="ðŸ‡§ðŸ‡©" data-open-start="" data-open-end="">
        <div class="time-header"><div class="time">â€”</div></div>
        <div class="date">â€”</div>
        <div class="timezone">â€”</div>
        <div class="market-status" aria-live="polite">â€”</div>
      </div>

      <div class="time-line" role="listitem" tabindex="0" id="tz-utc" data-tz="UTC" data-icon="ðŸ•˜" data-open-start="7" data-open-end="16">
        <div class="time-header"><div class="time">â€”</div></div>
        <div class="date">â€”</div>
        <div class="timezone">â€”</div>
        <div class="market-status" aria-live="polite">â€”</div>
      </div>

      <div class="time-line" role="listitem" tabindex="0" id="tz-ny" data-tz="America/New_York" data-icon="ðŸ‡ºðŸ‡¸" data-open-start="13" data-open-end="22">
        <div class="time-header"><div class="time">â€”</div></div>
        <div class="date">â€”</div>
        <div class="timezone">â€”</div>
        <div class="market-status" aria-live="polite">â€”</div>
      </div>

      <div class="time-line" role="listitem" tabindex="0" id="tz-tokyo" data-tz="Asia/Tokyo" data-icon="ðŸ‡¯ðŸ‡µ" data-open-start="0" data-open-end="9">
        <div class="time-header"><div class="time">â€”</div></div>
        <div class="date">â€”</div>
        <div class="timezone">â€”</div>
        <div class="market-status" aria-live="polite">â€”</div>
      </div>

      <div class="time-line" role="listitem" tabindex="0" id="tz-sydney" data-tz="Australia/Sydney" data-icon="ðŸ‡¦ðŸ‡º" data-open-start="21" data-open-end="6">
        <div class="time-header"><div class="time">â€”</div></div>
        <div class="date">â€”</div>
        <div class="timezone">â€”</div>
        <div class="market-status" aria-live="polite">â€”</div>
      </div>
    </div>

    <div class="info-box" aria-hidden="false">
      <h2>Market schedule (UTC)</h2>
      <p>â€¢ Sydney: 21:00 â€“ 06:00 UTC</p>
      <p>â€¢ Tokyo: 00:00 â€“ 09:00 UTC</p>
      <p>â€¢ London: 07:00 â€“ 16:00 UTC</p>
      <p>â€¢ New York: 13:00 â€“ 22:00 UTC</p>
    </div>
  </div>

  <script>
    // --- Utilities ---------------------------------------------------------
    const pad = n => String(n).padStart(2,'0');

    // Build a localized date/time using Intl parts so we don't rely on fragile parsing
    function getPartsForZone(timeZone) {
      const now = new Date();
      const fmt = new Intl.DateTimeFormat('en-GB', {
        timeZone,
        year: 'numeric', month: 'long', day: '2-digit', weekday: 'long',
        hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false
      });
      // We will ask for parts instead of formatted string where possible
      const parts = new Intl.DateTimeFormat('en-GB', {
        timeZone,
        year: 'numeric', month: 'long', day: '2-digit', weekday: 'long',
        hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false
      }).formatToParts(now).reduce((acc,p)=>{acc[p.type]=p.value;return acc;},{})
      return parts;
    }

    function formatDisplayDate(parts) {
      // desired: "01 January 2025 - Sunday"
      return `${parts.day} ${parts.month} ${parts.year} - ${parts.weekday}`;
    }

    function formatDisplayTimeForLocale(timeZone, hour12 = true) {
      const now = new Date();
      return new Intl.DateTimeFormat('en-US',{timeZone, hour:'2-digit', minute:'2-digit', second:'2-digit', hour12}).format(now);
    }

    // Get a Date object for the zone by constructing from parts (works reliably)
    function dateForZone(timeZone){
      const parts = getPartsForZone(timeZone);
      // parts.hour is 00-23
      // Construct a Date using the components interpreted as if in that timezone by using Date.UTC
      // But we don't actually need a real Date offset; for UTC hour extraction we will compute using timezone conversion below
      return parts;
    }

    // Calculate current UTC hour (0-23)
    function currentUtcHour(){
      return new Date().getUTCHours();
    }

    // Market status using UTC hour numbers (0-23) where openStart/openEnd are integers 0-23; if openStart>openEnd it crosses midnight
    function isMarketOpenUtc(utcHour, openStart, openEnd){
      if (openStart === '' || openEnd === '') return false;
      openStart = Number(openStart); openEnd = Number(openEnd);
      if (Number.isNaN(openStart) || Number.isNaN(openEnd)) return false;
      if (openStart > openEnd) return (utcHour >= openStart) || (utcHour < openEnd);
      return utcHour >= openStart && utcHour < openEnd;
    }

    // Get offset label like "UTC+6" or "GMT-5" using timeZoneName from Intl
    function offsetLabel(timeZone){
      try{
        const s = new Intl.DateTimeFormat('en-US',{timeZone, timeZoneName:'short'}).format(new Date());
        // format example: "1/1/2025, GMT+6" or "1/1/2025, GMT+10"
        const parts = s.split(',').map(p=>p.trim());
        return parts[parts.length-1];
      }catch(e){
        // fallback: try to compute offset number
        const now = new Date();
        const tzDate = new Date(now.toLocaleString('en-US',{timeZone}));
        const diff = - (tzDate.getTime() - now.getTime()) / 3600000; // approximate
        const sign = diff>=0?'+':'';
        return `UTC${sign}${diff}`;
      }
    }

    // --- Main update ------------------------------------------------------
    function updateAll(){
      const utcHour = currentUtcHour();
      const items = Array.from(document.querySelectorAll('.time-line'));

      items.forEach(el=>{
        const tz = el.dataset.tz || 'UTC';
        const parts = getPartsForZone(tz);
        const time12 = formatDisplayTimeForLocale(tz,true);
        el.querySelector('.time').textContent = time12;
        el.querySelector('.date').textContent = formatDisplayDate(parts);
        const offset = offsetLabel(tz);
        el.querySelector('.timezone').textContent = `${offset} (${tz})`;

        // market status: read data attributes
        const start = el.dataset.openStart;
        const end = el.dataset.openEnd;
        const statusEl = el.querySelector('.market-status');
        if (start !== undefined && end !== undefined && start !== '' && end !== ''){
          const open = isMarketOpenUtc(utcHour, start, end);
          statusEl.className = `market-status ${open ? 'open' : 'closed'}`;
          statusEl.textContent = `${el.id.includes('tz-') ? el.id.replace('tz-','').toUpperCase() : ''}: ${open ? 'Open' : 'Closed'} ${pad(start)}:00â€“${pad(end)}:00 UTC`;
        } else {
          // generic note
          statusEl.className = 'market-status';
          statusEl.textContent = 'Markets follow UTC schedule';
        }
      });
    }

    // --- Copy to clipboard with keyboard support and visual feedback -------
    function setupCopy(){
      const els = document.querySelectorAll('.time-line');
      els.forEach(el=>{
        const copy = () => {
          const time = el.querySelector('.time').textContent;
          const date = el.querySelector('.date').textContent;
          const tz = el.querySelector('.timezone').textContent;
          const status = el.querySelector('.market-status').textContent;
          const text = `${time} - ${date} - ${tz}\n${status}`;
          if (navigator.clipboard && navigator.clipboard.writeText){
            navigator.clipboard.writeText(text).catch(()=>{});
          } else {
            // fallback
            const ta = document.createElement('textarea'); ta.value = text; document.body.appendChild(ta); ta.select(); try{document.execCommand('copy')}catch(e){} ta.remove();
          }

          // short visual flash
          const orig = el.style.background;
          el.style.background = 'linear-gradient(90deg, rgba(16,185,129,0.08), rgba(16,185,129,0.04))';
          setTimeout(()=> el.style.background = orig, 320);
        };

        el.addEventListener('click', copy);
        el.addEventListener('keydown', e => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); copy(); } });
      });
    }

    // --- Init -------------------------------------------------------------
    updateAll();
    setupCopy();
    // update every second (times & UTC-based market status)
    setInterval(updateAll, 1000);

    // graceful degradation: if Intl/timeZone unsupported, notify via console
    try{ new Intl.DateTimeFormat('en-GB',{timeZone:'UTC'}).format() }catch(e){ console.warn('Your browser may not support Intl timeZone; times may be inaccurate.'); }
  </script>
</body>
</html>
